<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Fully Automatic Scanning with the Scansnap S500M on Linux | Kevin Liu</title> <meta name="author" content="Kevin Liu"/> <meta name="description" content="One-button scanning to PDF from a $50 scanner on eBay"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://kliu.io/post/automatic-scanning-with-scansnap-s500m/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://kliu.io/">Kevin Liu</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="https://www.icloud.com/sharedalbum/#B0iJtdOXmkYghC" target="_blank" rel="noopener noreferrer">photos</a> </li> <li class="nav-item "> <a class="nav-link" href="/reads">reads</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">writes</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/blog/">blog</a> <a class="dropdown-item" href="/moments/">moments</a> <a class="dropdown-item" href="/objects/">objects</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Fully Automatic Scanning with the Scansnap S500M on Linux</h1> <p class="post-meta">January 27, 2019</p> <p class="post-tags"> <a href="/blog/2019"> <i class="fas fa-calendar fa-sm"></i> 2019 </a>   ·   <a href="/blog/tag/tech"> <i class="fas fa-hashtag fa-sm"></i> tech</a>   </p> </header> <article class="post-content"> <p>I have a <em>massive</em> pile of schoolwork in paper form. (Mostly from History class, of course.) And when the accordian folder I used to use for storage filled up, I was left with two options:</p> <ol> <li>Buy a filing cabinet.</li> <li>Buy a scanner. (Sheet-fed, of course. There’s no way I’d spend hours scanning paper on a flatbed scanner.)</li> </ol> <p>Enter the Fujitsu ScanSnap S500M. Released in 2007 (its <a href="http://www.fujitsu.com/us/products/computing/peripheral/scanners/product/eol/s500m/" target="_blank" rel="noopener noreferrer">minimum system requirements</a> recommend the PowerPC G4), it is so outdated that not one, but <em>two</em> models have been released to succeed it: the S1500M and the iX500.</p> <p>There are some benefits, however: it’s ridiculously cheap on eBay, and, despite its age, it still scans 600 dpi in color. Just really slowly. Naturally, I bought one.</p> <p>Now, since the scanner is white, Fujitsu only ever released Mac drivers for it. (The ScanSnap S500 is its black, Windows counterpart.) But thanks to the tireless work of unpaid Linux enthusiasts, it is <a href="http://www.sane-project.org/sane-mfgs.html#Z-FUJITSU" target="_blank" rel="noopener noreferrer">fully supported</a> by SANE, Linux’s scanner access library. Thus, after plugging it in, I could use <em>already</em> use it seamlessly with applications like <a href="https://gitlab.gnome.org/GNOME/simple-scan" target="_blank" rel="noopener noreferrer">Simple Scan</a>.</p> <p>However, “12-year-old hardware works perfectly on Linux” probably wouldn’t be that newsworthy. (Or would it?) As useful as Simple Scan is, I wanted a more convenient solution that didn’t involved starting up a program on my desktop and manually clicking Scan -&gt; Scan All From Feeder. Ideally, I would be able to just click the Scan button and have it automatically scan all pages to a timestamped, black-and-white PDF.</p> <p>Here’s how I got there.</p> <h2 id="scanner-button-daemon">Scanner Button Daemon</h2> <p>One of the lesser-known daemons on Linux is the <a href="https://wiki.archlinux.org/index.php/Scanner_Button_Daemon" target="_blank" rel="noopener noreferrer">Scanner Button Daemon</a>, or <code class="language-plaintext highlighter-rouge">scanbd</code>. <code class="language-plaintext highlighter-rouge">scanbd</code> quietly runs in the background, polling for scanner button presses and running commands on specific presses. Thankfully, it supports the S500M. You can start it by running <code class="language-plaintext highlighter-rouge">scanbd --config=&lt;config&gt;.conf</code>, which I wrapped in a simple systemd service. Then, I edited the stock configuration file’s <code class="language-plaintext highlighter-rouge">action scan</code> to look like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>action scan {
        filter = "^scan.*"
        numerical-trigger {
                from-value = 1
                to-value   = 0
        }
        desc   = "Scan to file"
        # script must be an relative path starting from scriptdir (see above),
        # or an absolute pathname.
        # It must contain the path to the action script without arguments
        # Absolute path example: script = "/some/path/foo.script
        script = "/etc/scan.sh"
}
</code></pre></div></div> <p>Note the line <code class="language-plaintext highlighter-rouge">script = "/etc/scan.sh"</code>. This means that <code class="language-plaintext highlighter-rouge">scanbd</code> will execute <code class="language-plaintext highlighter-rouge">/etc/scan.sh</code> when you press the scan button. Thus, by making <code class="language-plaintext highlighter-rouge">/etc/scan.sh</code> an automated scanner script, I could automate a scan.</p> <p>Here’s what it looks like.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">lib</span><span class="p">.makeBinPath [ pkgs.coreutils pkgs.sane-backends pkgs.imagemagickpkgs.ghostscript ]</span><span class="k">}</span>
<span class="nb">set</span> <span class="nt">-x</span>
<span class="nb">date</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">--iso-8601</span><span class="o">=</span>seconds<span class="si">)</span><span class="s2">"</span>
<span class="nv">filename</span><span class="o">=</span><span class="s2">"Scan </span><span class="nv">$date</span><span class="s2">.pdf"</span>
<span class="nb">exec </span>3&gt;&amp;1 1&gt;&gt;<span class="s2">"/srv/paperless-incoming/</span><span class="nv">$filename</span><span class="s2">.log"</span> 2&gt;&amp;1
<span class="nv">tmpdir</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">pushd</span> <span class="s2">"</span><span class="nv">$tmpdir</span><span class="s2">"</span>
scanimage <span class="nt">--batch</span><span class="o">=</span>out%d.jpg <span class="nt">--format</span><span class="o">=</span>jpeg <span class="nt">--mode</span> Gray <span class="nt">-d</span> <span class="s2">"fujitsu:ScanSnap S500M:4530"</span><span class="nt">--source</span> <span class="s2">"ADF Duplex"</span> <span class="nt">--resolution</span> 300

<span class="k">for </span>i <span class="k">in </span>out<span class="k">*</span>.jpg<span class="p">;</span> <span class="k">do </span>convert <span class="nv">$i</span> <span class="s1">''</span><span class="k">${</span><span class="nv">i</span><span class="p">//jpg/pdf</span><span class="k">}</span><span class="p">;</span> <span class="k">done
</span>gs <span class="nt">-dNOPAUSE</span> <span class="nt">-sDEVICE</span><span class="o">=</span>pdfwrite <span class="nt">-sOUTPUTFILE</span><span class="o">=</span><span class="s2">"/srv/paperless-incoming/</span><span class="nv">$filename</span><span class="s2">"</span> <span class="nt">-dBATCH</span><span class="sb">`</span><span class="nb">ls</span> <span class="nt">-v</span> out<span class="k">*</span>.pdf<span class="sb">`</span>
<span class="nb">chown</span> <span class="nt">-R</span> kevin:users /srv/paperless-incoming
<span class="nb">popd
rm</span> <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$tmpdir</span><span class="s2">"</span>
</code></pre></div></div> <p>Lines of note:</p> <ol> <li> <code class="language-plaintext highlighter-rouge">export PATH=...</code>: You can mostly ignore this; this is for NixOS to declare the script’s dependencies.</li> <li> <code class="language-plaintext highlighter-rouge">filename="Scan $date.pdf"</code>: Sets the scan filename to <code class="language-plaintext highlighter-rouge">Scan &lt;date&gt;.pdf</code>.</li> <li> <code class="language-plaintext highlighter-rouge">exec 3&gt;&amp;1 1&gt;&gt;"/srv/paperless-incoming/$filename.log" 2&gt;&amp;1</code>: Redirect all script output to a log file. This is useful because scanbd doesn’t really log what happens in the script.</li> <li> <code class="language-plaintext highlighter-rouge">scanimage --batch=out%d.jpg --format=jpeg --mode Gray -d "fujitsu:ScanSnap S500M:4530"--source "ADF Duplex" --resolution 300</code>: Scan from the S500M’s <em>duplex</em> source, at 300 dpi, saving as JPEGs named out1.jpg, out2.jpg, etc. The <code class="language-plaintext highlighter-rouge">--source</code> option tripped me up initially, because the default is only to scan the front side.</li> <li> <code class="language-plaintext highlighter-rouge">for i in out*.jpg; do convert $i ''${i//jpg/pdf}; done</code>: Convert each JPEG to a PDF. I didn’t convert them all at once (i.e. <code class="language-plaintext highlighter-rouge">convert *.jpg out.pdf</code>) because ImageMagick <em>really</em> enjoys using up memory.</li> <li> <code class="language-plaintext highlighter-rouge">gs -dNOPAUSE -sDEVICE=pdfwrite -sOUTPUTFILE="/srv/paperless-incoming/$filename" -dBATCH $(ls -v out*.pdf)</code>: This uses ghostscript to concatenate the PDFs and place the final product in <code class="language-plaintext highlighter-rouge">/srv/paperless-incoming</code>. It uses <code class="language-plaintext highlighter-rouge">ls -v</code> so that e.g. <code class="language-plaintext highlighter-rouge">out2.pdf</code> comes <em>before</em> <code class="language-plaintext highlighter-rouge">out11.pdf</code>.</li> </ol> <p>And voila. Combined with software like <a href="https://github.com/danielquinn/paperless" target="_blank" rel="noopener noreferrer">Paperless</a> for auto-OCRing, you basically have a fully-automated scan processing center!</p> </article> <hr> <div style="text-align: center;"> <p>If you like reading these posts, get new ones via email:</p> <div id="mc_embed_signup"> <form action="https://kliu.us10.list-manage.com/subscribe/post?u=5539e4dff5ee082eef001e612&amp;id=f9f0fa279e&amp;f_id=000b36e2f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll"> <div class="mc-field-group" style="margin-bottom: 1em"> <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" required placeholder="email address"> <span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"> </div> <div id="mce-responses" class="clear foot"> <div class="response" id="mce-error-response" style="display:none"></div> <div class="response" id="mce-success-response" style="display:none; margin-bottom: 1em"></div> </div> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_5539e4dff5ee082eef001e612_f9f0fa279e" tabindex="-1" value=""></div> <div class="optionalParent"> <div class="clear foot"> </div> </div> </div> </form> </div> <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script> <script type="text/javascript">jQuery,window.fnames=new Array,window.ftypes=new Array,fnames[0]="EMAIL",ftypes[0]="email",fnames[1]="FNAME",ftypes[1]="text",fnames[2]="LNAME",ftypes[2]="text",fnames[3]="ADDRESS",ftypes[3]="address",fnames[4]="PHONE",ftypes[4]="phone",fnames[5]="BIRTHDAY",ftypes[5]="birthday";var $mcj=jQuery.noConflict(!0);</script> </div> <div id="disqus_thread"></div> <script type="text/javascript">var disqus_shortname="kevin-liu",disqus_identifier="/post/automatic-scanning-with-scansnap-s500m",disqus_title="Fully Automatic Scanning with the Scansnap S500M on Linux";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a> </noscript> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © 2022 Kevin Liu. Licensed under CC BY-SA 4.0. Last updated: October 23, 2022. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-KKF0HL5TKT"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKF0HL5TKT");</script> </body> </html>